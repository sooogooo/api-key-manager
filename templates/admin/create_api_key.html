{% extends "admin/base.html" %}

{% block title %}åˆ›å»ºAPIå¯†é’¥{% endblock %}

{% block content %}
<div class="container">
    {% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ”‘ åˆ›å»ºæ–°APIå¯†é’¥</h5>
                </div>
                
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin.create_api_key') }}" class="needs-validation" novalidate>
                        <div class="mb-4">
                            <label for="name" class="form-label">å¯†é’¥åç§°</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="name" 
                                   name="name" 
                                   placeholder="ä¾‹å¦‚ï¼šæµ‹è¯•ç¯å¢ƒå¯†é’¥" 
                                   required>
                            <div class="form-text">ä¸ºå¯†é’¥æŒ‡å®šä¸€ä¸ªæ˜“äºè¯†åˆ«çš„åç§°</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="validity_days" class="form-label">æœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="validity_days" 
                                   name="validity_days" 
                                   value="365" 
                                   min="1" 
                                   max="3650" 
                                   required>
                            <div class="form-text">
                                è®¾ç½®å¯†é’¥çš„æœ‰æ•ˆæœŸé™ï¼ˆ1-3650å¤©ï¼‰ã€‚è®¾ä¸º0è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="daily_limit" class="form-label">æ¯æ—¥è°ƒç”¨é™åˆ¶</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="daily_limit" 
                                   name="daily_limit" 
                                   value="1000" 
                                   min="1" 
                                   max="100000" 
                                   required>
                            <div class="form-text">
                                è®¾ç½®æ¯å¤©æœ€å¤šå¯ä»¥è°ƒç”¨APIçš„æ¬¡æ•°ï¼ˆ1-100000æ¬¡ï¼‰
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-key-fill"></i> åˆ›å»ºå¯†é’¥
                            </button>
                            <a href="{{ url_for('admin.list_api_keys') }}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> è¿”å›åˆ—è¡¨
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card shadow-sm mt-4">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ’¡ æ³¨æ„äº‹é¡¹</h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li>å¯†é’¥åˆ›å»ºåå°†ç«‹å³ç”Ÿæ•ˆ</li>
                        <li>å¯†é’¥å€¼å°†æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡µé¢ï¼Œåˆ›å»ºåè¯·åŠæ—¶ä¿å­˜</li>
                        <li>å»ºè®®è®¾ç½®åˆç†çš„æœ‰æ•ˆæœŸå’Œè°ƒç”¨é™åˆ¶</li>
                        <li>å¯ä»¥éšæ—¶åœ¨åˆ—è¡¨ä¸­ç¦ç”¨æˆ–åˆ é™¤å¯†é’¥</li>
                        <li>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå»ºè®®ï¼š
                            <ul>
                                <li>ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒçš„å¯†é’¥</li>
                                <li>å®šæœŸæ›´æ¢å¯†é’¥</li>
                                <li>è®¾ç½®é€‚å½“çš„è¿‡æœŸæ—¶é—´</li>
                                <li>åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯†é’¥</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// è¡¨å•éªŒè¯
(function () {
    'use strict'
    
    const forms = document.querySelectorAll('.needs-validation')
    
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            
            form.classList.add('was-validated')
        }, false)
    })
})()

// æœ‰æ•ˆæœŸè¾“å…¥å¤„ç†
document.getElementById('validity_days').addEventListener('change', function() {
    if (this.value < 0) {
        this.value = 0;
    } else if (this.value > 3650) {
        this.value = 3650;
    }
});

// è°ƒç”¨é™åˆ¶è¾“å…¥å¤„ç†
document.getElementById('daily_limit').addEventListener('change', function() {
    if (this.value < 1) {
        this.value = 1;
    } else if (this.value > 100000) {
        this.value = 100000;
    }
});
</script>
{% endblock %}